<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì View Admission Applications</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI,system-ui;
  background:#0f172a;
  color:#fff;
}

.container{padding:20px}
h2{margin-bottom:16px}

table{
  width:100%;
  border-collapse:collapse;
  background:#020617;
  border-radius:12px;
  overflow:hidden;
}

th,td{
  padding:12px;
  text-align:center;
  border-bottom:1px solid #1e293b;
}

th{background:#1e40af}
tr:hover{background:#020617cc}

button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

.approve{background:#22c55e;color:#fff}
.reject{background:#ef4444;color:#fff;margin-left:6px}

.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
}

.badge-approved{background:#22c55e}
.badge-rejected{background:#ef4444}
.badge-pending{background:#facc15;color:#000}

.error{
  color:#f87171;
  text-align:center;
  padding:16px;
}
</style>
</head>

<body>

<div class="container">
  <h2>üìÑ Admission Applications (Admin)</h2>

  <table>
    <thead>
      <tr>
        <th>Admission ID</th>
        <th>Name</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Course</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr>
        <td colspan="7">Loading‚Ä¶</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
const API_BASE = "https://mdpu-college-portal.onrender.com";
const token = localStorage.getItem("token");
const tbody = document.getElementById("tableBody");

if(!token){
  tbody.innerHTML =
    "<tr><td colspan='7' class='error'>‚ùå Please login as Admin</td></tr>";
  throw new Error("JWT token missing");
}

// üîÑ LOAD APPLICATIONS
async function loadAdmissions(){
  try{
    const res = await fetch(`${API_BASE}/api/admission/admin/all`,{
      headers:{ "Authorization":"Bearer " + token }
    });

    if(!res.ok) throw new Error("Unauthorized");

    const data = await res.json();
    tbody.innerHTML = "";

    if(data.length === 0){
      tbody.innerHTML =
        "<tr><td colspan='7'>No applications found</td></tr>";
      return;
    }

    data.forEach(a=>{
      let actionHtml = "";
      let statusHtml = "";

      if(a.status === "APPLICATION RECEIVED"){
        statusHtml = `<span class="badge badge-pending">PENDING</span>`;
        actionHtml = `
          <button class="approve" onclick="approve(${a.id})">Approve</button>
          <button class="reject" onclick="reject(${a.id})">Reject</button>
        `;
      }
      else if(a.status === "APPROVED"){
        statusHtml = `<span class="badge badge-approved">APPROVED</span>`;
        actionHtml = "‚Äî";
      }
      else if(a.status === "REJECTED"){
        statusHtml = `<span class="badge badge-rejected">REJECTED</span>`;
        actionHtml = "‚Äî";
      }

      tbody.innerHTML += `
        <tr>
          <td>${a.admissionId}</td>
          <td>${a.name?.trim() || "Student"}</td>
          <td>${a.mobile}</td>
          <td>${a.email}</td>
          <td>${a.combination}</td>
          <td>${statusHtml}</td>
          <td>${actionHtml}</td>
        </tr>
      `;
    });

  }catch(err){
    tbody.innerHTML =
      "<tr><td colspan='7' class='error'>‚ùå Failed to load data</td></tr>";
    console.error(err);
  }
}

loadAdmissions();

// ‚úÖ APPROVE
async function approve(id){
  if(!confirm("Approve this application?")) return;

  await fetch(`${API_BASE}/api/admission/admin/approve/${id}`,{
    method:"PUT",
    headers:{ "Authorization":"Bearer " + token }
  });

  alert("‚úÖ Application Approved");
  loadAdmissions();
}

// ‚ùå REJECT
async function reject(id){
  if(!confirm("Reject this application?")) return;

  await fetch(`${API_BASE}/api/admission/admin/reject/${id}`,{
    method:"PUT",
    headers:{ "Authorization":"Bearer " + token }
  });

  alert("‚ùå Application Rejected");
  loadAdmissions();
}
</script>

</body>
</html>
