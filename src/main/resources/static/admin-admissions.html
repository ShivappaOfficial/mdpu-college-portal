<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì View Admission Applications</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI,system-ui;
  background:#0f172a;
  color:#fff;
}

.container{
  padding:20px;
}

h2{
  margin-bottom:16px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#020617;
  border-radius:12px;
  overflow:hidden;
}

th,td{
  padding:12px;
  text-align:center;
  border-bottom:1px solid #1e293b;
}

th{
  background:#1e40af;
}

tr:hover{
  background:#020617cc;
}

button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}

.approve{
  background:#22c55e;
  color:#fff;
}

.reject{
  background:#ef4444;
  color:#fff;
  margin-left:6px;
}

.error{
  color:#f87171;
  text-align:center;
  padding:16px;
}
</style>
</head>

<body>

<div class="container">
  <h2>üìÑ Admission Applications (Admin)</h2>

  <table>
    <thead>
      <tr>
        <th>Admission ID</th>
        <th>Name</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Course</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr>
        <td colspan="7">Loading...</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
const API_BASE = "https://mdpu-college-portal.onrender.com";

// üîê GET JWT TOKEN
const token = localStorage.getItem("token");

if(!token){
  document.getElementById("tableBody").innerHTML =
    "<tr><td colspan='7' class='error'>‚ùå Not logged in</td></tr>";
  throw new Error("JWT token missing");
}

// üì• LOAD APPLICATIONS
fetch(`${API_BASE}/api/admission/admin/all`,{
  headers:{
    "Authorization":"Bearer " + token
  }
})
.then(res=>{
  if(!res.ok) throw new Error("Unauthorized");
  return res.json();
})
.then(data=>{
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";

  if(data.length===0){
    tbody.innerHTML =
      "<tr><td colspan='7'>No applications found</td></tr>";
    return;
  }

  data.forEach(a=>{
    tbody.innerHTML+=`
      <tr>
        <td>${a.admissionId}</td>
        <td>${a.name ?? "Student"}</td>
        <td>${a.mobile}</td>
        <td>${a.email}</td>
        <td>${a.combination}</td>
        <td>${a.status}</td>
        <td>
          <button class="approve" onclick="approve(${a.id})">Approve</button>
          <button class="reject" onclick="reject(${a.id})">Reject</button>
        </td>
      </tr>
    `;
  });
})
.catch(err=>{
  document.getElementById("tableBody").innerHTML =
    "<tr><td colspan='7' class='error'>‚ùå Failed to fetch data</td></tr>";
});

// ‚úÖ APPROVE
function approve(id){
  fetch(`${API_BASE}/api/admission/admin/approve/${id}`,{
    method:"PUT",
    headers:{
      "Authorization":"Bearer " + token
    }
  }).then(()=>{
    alert("Approved");
    location.reload();
  });
}

// ‚ùå REJECT
function reject(id){
  fetch(`${API_BASE}/api/admission/admin/reject/${id}`,{
    method:"PUT",
    headers:{
      "Authorization":"Bearer " + token
    }
  }).then(()=>{
    alert("Rejected");
    location.reload();
  });
}
</script>

</body>
</html>
