<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Admission Applications</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    min-height:100vh;
    color:#fff;
}

.page-title{
    font-weight:600;
    margin-bottom:20px;
}

.glass{
    background: rgba(255,255,255,.12);
    backdrop-filter: blur(12px);
    border-radius:16px;
    padding:20px;
}

table th{
    background:#1e3c72 !important;
    color:white;
    white-space: nowrap;
}

table td{
    background: rgba(255,255,255,0.05);
    color:white;
    vertical-align: middle;
}

.badge{
    font-size: 0.85rem;
}

@media (max-width:768px){
    .page-title{
        font-size:18px;
        text-align:center;
    }
}
</style>
</head>

<body>

<div class="container py-4">

    <h4 class="page-title">üìã Admission Applications (Admin)</h4>

    <div class="glass">

        <div class="table-responsive">
            <table class="table table-bordered table-hover text-center align-middle mb-0">
                <thead>
                    <tr>
                        <th>Admission ID</th>
                        <th>Name</th>
                        <th>Mobile</th>
                        <th>Email</th>
                        <th>Course</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="7">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<script>
const API_BASE = "http://localhost:8080";
const token = localStorage.getItem("token");
const tbody = document.getElementById("tableBody");

/* üîê Auth check */
if(!token){
    tbody.innerHTML = `<tr><td colspan="7">‚ùå Unauthorized</td></tr>`;
    throw new Error("No JWT token");
}

/* üîÑ Load applications */
fetch(`${API_BASE}/api/admission/admin/all`, {
    headers: {
        "Authorization": "Bearer " + token
    }
})
.then(res => {
    if(!res.ok) throw new Error("Failed to load data");
    return res.json();
})
.then(data => {

    tbody.innerHTML = "";

    if(data.length === 0){
        tbody.innerHTML = `<tr><td colspan="7">No Applications Found</td></tr>`;
        return;
    }

    data.forEach(a => {

        let badgeClass =
            a.status === "APPROVED" ? "bg-success" :
            a.status === "REJECTED" ? "bg-danger" :
            "bg-warning text-dark";

        tbody.innerHTML += `
        <tr>
            <td>${a.admissionId}</td>
            <td>${a.name}</td>
            <td>${a.mobile}</td>
            <td>${a.email ?? "-"}</td>
            <td>${a.combination}</td>
            <td>
                <span class="badge ${badgeClass}">
                    ${a.status}
                </span>
            </td>
            <td>
                <button class="btn btn-success btn-sm me-1"
                    onclick="approve(${a.id})"
                    ${a.status === 'APPROVED' ? 'disabled' : ''}>
                    <i class="bi bi-check-lg"></i>
                </button>

                <button class="btn btn-danger btn-sm"
                    onclick="reject(${a.id})"
                    ${a.status === 'REJECTED' ? 'disabled' : ''}>
                    <i class="bi bi-x-lg"></i>
                </button>
            </td>
        </tr>
        `;
    });
})
.catch(err => {
    tbody.innerHTML =
        `<tr><td colspan="7">‚ùå ${err.message}</td></tr>`;
});

/* ‚úÖ Approve */
function approve(id){
    if(!confirm("Approve this application?")) return;

    fetch(`${API_BASE}/api/admission/admin/approve/${id}`, {
        method: "PUT",
        headers:{
            "Authorization": "Bearer " + token
        }
    })
    .then(() => location.reload())
    .catch(() => alert("Approve failed"));
}

/* ‚ùå Reject */
function reject(id){
    if(!confirm("Reject this application?")) return;

    fetch(`${API_BASE}/api/admission/admin/reject/${id}`, {
        method: "PUT",
        headers:{
            "Authorization": "Bearer " + token
        }
    })
    .then(() => location.reload())
    .catch(() => alert("Reject failed"));
}
</script>

</body>
</html>
