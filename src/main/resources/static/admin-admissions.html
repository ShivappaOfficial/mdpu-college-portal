<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Admissions</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Segoe UI,system-ui;
  background:#f1f5f9;
  margin:0;padding:20px;
}
h2{margin-bottom:15px}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}
th{background:#e2e8f0}
button{
  padding:6px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.view{background:#3b82f6;color:white}
.approve{background:#22c55e;color:white}
.reject{background:#ef4444;color:white}

/* MODAL */
#previewModal{
  display:none;
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.6);
  z-index:9999;
}
#modalBox{
  background:#fff;
  max-width:700px;
  margin:5% auto;
  padding:20px;
  border-radius:14px;
}
#modalBox h3{margin-top:0}
.closeBtn{
  background:#64748b;
  color:white;
}
</style>
</head>

<body>

<h2>ðŸ“‹ Admission Applications</h2>

<table>
<thead>
<tr>
  <th>Name</th>
  <th>Admission ID</th>
  <th>Mobile</th>
  <th>Combination</th>
  <th>Status</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<!-- PREVIEW MODAL -->
<div id="previewModal">
  <div id="modalBox">
    <h3>ðŸ“„ Application Details</h3>
    <div id="previewContent"></div>
    <br>
    <button class="closeBtn" onclick="closePreview()">Close</button>
  </div>
</div>

<script>
const tbody = document.getElementById("tbody");

fetch("/api/admission/admin/all")
  .then(r=>r.json())
  .then(data=>{
    tbody.innerHTML="";
    data.forEach(app=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${app.name || "Student"}</td>
        <td>${app.admissionId}</td>
        <td>${app.mobile}</td>
        <td>${app.combination}</td>
        <td>${app.status}</td>
        <td>
          <button class="view" onclick='openPreview(${JSON.stringify(app)})'>View</button>
          <button class="approve" onclick="approve(${app.id})">Approve</button>
          <button class="reject" onclick="reject(${app.id})">Reject</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  });

function openPreview(app){
  document.getElementById("previewContent").innerHTML=`
    <p><b>Name:</b> ${app.name || "Student"}</p>
    <p><b>Father:</b> ${app.fatherName}</p>
    <p><b>Mother:</b> ${app.motherName}</p>
    <p><b>Admission ID:</b> ${app.admissionId}</p>
    <p><b>Email:</b> ${app.email}</p>
    <p><b>Mobile:</b> ${app.mobile}</p>
    <p><b>Combination:</b> ${app.combination}</p>
    <p><b>Percentage:</b> ${app.percentage}%</p>
    <p><b>Status:</b> ${app.status}</p>
    <hr>
    <p><b>Kannada:</b> ${app.kannada}</p>
    <p><b>English:</b> ${app.english}</p>
    <p><b>Hindi:</b> ${app.hindi}</p>
    <p><b>Maths:</b> ${app.mathematics}</p>
    <p><b>Science:</b> ${app.science}</p>
    <p><b>Social:</b> ${app.socialScience}</p>
  `;
  document.getElementById("previewModal").style.display="block";
}

function closePreview(){
  document.getElementById("previewModal").style.display="none";
}

function approve(id){
  if(!confirm("Approve this application?")) return;
  fetch(`/api/admission/admin/approve/${id}`,{method:"PUT"})
    .then(()=>location.reload());
}

function reject(id){
  if(!confirm("Reject this application?")) return;
  fetch(`/api/admission/admin/reject/${id}`,{method:"PUT"})
    .then(()=>location.reload());
}
</script>

</body>
</html>
