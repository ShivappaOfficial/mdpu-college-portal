<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Gallery</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">

<h4 class="mb-3">ðŸ–¼ Gallery Management</h4>

<!-- Upload -->
<input type="file" id="file" class="form-control mb-2" accept="image/*">
<button class="btn btn-primary mb-3" onclick="upload()">Upload Image</button>

<!-- Table -->
<table class="table table-bordered text-center align-middle">
<thead class="table-dark">
<tr>
  <th>ID</th>
  <th>Preview</th>
  <th>File Name</th>
</tr>
</thead>
<tbody id="tbody">
<tr><td colspan="3">Loading...</td></tr>
</tbody>
</table>

<script>
loadGallery();

function upload(){
  const file = document.getElementById("file").files[0];
  if(!file){ alert("Select image"); return; }

  const formData = new FormData();
  formData.append("file", file);

  fetch("/api/gallery/upload", {
    method: "POST",
    body: formData
  })
  .then(res => {
    if(!res.ok) throw new Error("Upload failed");
    return res.text();
  })
  .then(() => {
    loadGallery();
    document.getElementById("file").value = "";
  })
  .catch(err => alert(err.message));
}

function loadGallery(){
  fetch("/api/gallery")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";

      if(data.length === 0){
        tbody.innerHTML = `<tr><td colspan="3">No Images</td></tr>`;
        return;
      }

      data.forEach(g => {
        tbody.innerHTML += `
          <tr>
            <td>${g.id}</td>
            <td>
              <img src="${g.filePath}" width="80" height="60" style="object-fit:cover">
            </td>
            <td>${g.fileName}</td>
          </tr>
        `;
      });
    });
}
</script>

</body>
</html>
