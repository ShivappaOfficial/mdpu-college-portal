<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admission | MDR PU Science College</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
  --primary:#004080;
  --accent:#00cc99;
  --yellow:#f1f807;
  --success:#22c55e;
  --error:#ef4444;
  --muted:#64748b;
}

/* ================= NAVBAR ================= */
header{
  position:fixed;
  top:0;
  width:100%;
  z-index:1000;
  background:var(--primary);
}
.header-container{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 20px;
}
.logo{
  display:flex;
  align-items:center;
  gap:10px;
  color:#fff;
  text-decoration:none;
}
.logo-icon{
  width:42px;
  height:42px;
  border-radius:50%;
  background:#fff;
  color:var(--primary);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}
.logo-text h1{font-size:18px;margin:0}
.logo-text p{font-size:12px;margin:0;opacity:.9}

/* Desktop Nav */
.nav-links{
  display:flex;
  gap:15px;
  align-items:center;
}
.nav-links a{
  color:#fff;
  text-decoration:none;
  padding:8px 14px;
  border-radius:20px;
  transition:.3s;
}
.nav-links a:hover,
.nav-links a.active{
  background:var(--accent);
  color:#000;
}
.dropdown{position:relative}
.dropdown-content{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  background:#003366;
  list-style:none;
  padding:8px 0;
  border-radius:8px;
  min-width:180px;
}
.dropdown-content li a{
  display:block;
  padding:8px 15px;
}
.dropdown:hover .dropdown-content{display:block}
.admin-btn{background:var(--yellow);color:#000}

/* Mobile */
.mobile-menu-btn{
  display:none;
  background:none;
  border:none;
  color:#fff;
  font-size:22px;
}

/* ================= MOBILE MENU ================= */
.mobile-menu{
  position:fixed;
  top:0;
  right:-100%;
  width:280px;
  height:100%;
  background:var(--primary);
  padding:70px 20px;
  transition:.3s;
  z-index:2000;
}
.mobile-menu.active{right:0}
.mobile-menu a{
  display:block;
  color:#fff;
  padding:12px 0;
  border-bottom:1px solid rgba(255,255,255,.2);
  text-decoration:none;
}
.mobile-menu-actions{
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.mobile-menu-close{
  position:absolute;
  top:15px;
  right:15px;
  background:none;
  border:none;
  color:#fff;
  font-size:24px;
  cursor:pointer;
}

/* ================= BODY ================= */
body{
  margin:0;
  padding-top:90px;
  min-height:100vh;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  display:flex;
  justify-content:center;
}

/* ================= ADMISSION FORM ================= */
.card{
  width:100%;
  max-width:900px;
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:22px;
  margin:20px;
}
h2{text-align:center;margin-bottom:12px}
.progress{height:8px;background:rgba(255,255,255,.2);border-radius:10px;overflow:hidden;margin-bottom:18px}
.progress-bar{height:100%;width:50%;background:linear-gradient(90deg,var(--primary),var(--success))}
.step{display:none}
.step.active{display:block}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
input,select{
  padding:12px;
  border-radius:10px;
  border:none;
  outline:none;
}
input[readonly]{background:#e5e7eb}
.subject-row{display:flex;gap:10px;margin-bottom:10px}
.subject-row input{flex:1}
.btns{display:flex;justify-content:space-between;margin-top:20px}
button{
  padding:12px 22px;
  border:none;
  border-radius:12px;
  background:var(--primary);
  color:white;
  font-weight:600;
}
button.secondary{background:var(--muted)}

#alertBox{
  position:fixed;
  top:20px;
  right:20px;
  padding:14px 18px;
  border-radius:14px;
  font-weight:600;
  display:none;
  z-index:3000;
}
.alert-success{background:var(--success)}
.alert-error{background:var(--error)}
.alert-info{background:#3b82f6}

@media(max-width:1200px){
  .nav-links{display:none}
  .mobile-menu-btn{display:block}
}
@media(max-width:768px){
  .grid{grid-template-columns:1fr}
}
@media (max-width: 480px) {

  .card{
    width: 95%;
    margin: 10px auto;
    padding: 16px;
  }

  h2{
    font-size: 18px;
  }

  .grid{
    grid-template-columns: 1fr;
  }

  input, select{
    font-size: 14px;
    padding: 10px;
  }

  .btns{
    flex-direction: column;
    gap: 10px;
  }

  .btns button{
    width: 100%;
  }
}

</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
  <div class="header-container">
    <a href="index.html" class="logo">
      <div class="logo-icon">MDR</div>
      <div class="logo-text">
        <h1>MDR PU Science College</h1>
        <p>Hiresindhogi | Excellence in Education</p>
      </div>
    </a>

    <nav>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#programs">Programs</a>
        <a href="gallery.html">Gallery</a>
        <a href="admission.html" class="active">Admission</a>

        <div class="dropdown">
          <a href="#">More ‚ñæ</a>
          <ul class="dropdown-content">
            <li><a href="alumni.html">Join As Alumni</a></li>
            <li><a href="alumni-batches.html">View Alumni</a></li>
            <li><a href="check-status.html">Application Status</a></li>
          </ul>
        </div>

        <a href="admin.html" class="admin-btn" style="background-color: #0d6efd;">Admin</a>
      </div>
    </nav>

    <button class="mobile-menu-btn" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</header>

<!-- ================= MOBILE MENU ================= -->
<div class="mobile-menu" id="mobileMenu">
  <button class="mobile-menu-close" id="mobileMenuClose">
    <i class="fas fa-times"></i>
  </button>

  <a href="index.html">Home</a>
  <a href="index.html#programs">Programs</a>
  <a href="gallery.html">Gallery</a>
  <a href="admission.html" class="active">Admission</a>
  <a href="alumni.html">Join As Alumni</a>
  <a href="check-status.html">Application Status</a>

  <div class="mobile-menu-actions">
    <a href="admin.html" class="btn btn-primary">Admin</a>
  </div>
</div>

<!-- ================= ALERT ================= -->
<div id="alertBox"></div>

<!-- ================= FORM ================= -->
<div class="card">
<h2>üéì PU College Admission</h2>

<div class="progress">
  <div class="progress-bar" id="progressBar"></div>
</div>

<form id="admissionForm">

<div class="step active" id="step1">
  <div class="grid">
    <input id="name" placeholder="Student Name *" required>
    <input id="fatherName" placeholder="Father Name *" required>
    <input id="motherName" placeholder="Mother Name *" required>
    <input type="date" id="dob" required>
    <input id="mobile" placeholder="Mobile *" required>
    <input id="familyMobile" placeholder="Family Mobile">
    <input type="email" id="email" placeholder="Email *" required>
    <input id="satsId" placeholder="SATS ID *" required>
    <input id="sslcRegNo" placeholder="SSLC Reg No *" required>
  </div>

  <div class="btns">
    <span></span>
    <button type="button" onclick="nextStep()">Next ‚Üí</button>
  </div>
</div>

<div class="step" id="step2">
<h4>üìö Subject-wise Marks</h4>

<div id="subjects">
  <div class="subject-row"><input value="Kannada" readonly><input id="kannada" type="number" oninput="calc()" required></div>
  <div class="subject-row"><input value="English" readonly><input id="english" type="number" oninput="calc()" required></div>
  <div class="subject-row"><input value="Hindi" readonly><input id="hindi" type="number" oninput="calc()" required></div>
  <div class="subject-row"><input value="Mathematics" readonly><input id="maths" type="number" oninput="calc()" required></div>
  <div class="subject-row"><input value="Science" readonly><input id="science" type="number" oninput="calc()" required></div>
  <div class="subject-row"><input value="Social Science" readonly><input id="social" type="number" oninput="calc()" required></div>
</div>

<div class="grid" style="margin-top:14px">
  <input id="obtainedMarks" placeholder="Total Obtained Marks" readonly>
  <input id="totalMarks" value="625" readonly>
  <input id="percentage" placeholder="Percentage" readonly>
  <select id="combination" required>
    <option value="">Select Combination</option>
    <option>PCMB</option>
    <option>PCMC</option>
  </select>
</div>

<div class="btns">
  <button type="button" class="secondary" onclick="prevStep()">‚Üê Back</button>
  <button type="submit">üöÄ Submit</button>
</div>
</div>

</form>
</div>

<!-- ================= JS ================= -->
<script>
/* ================= MOBILE MENU ================= */
const mobileMenu = document.getElementById("mobileMenu");
document.getElementById("mobileMenuBtn").onclick = () =>
  mobileMenu.classList.add("active");
document.getElementById("mobileMenuClose").onclick = () =>
  mobileMenu.classList.remove("active");
document.querySelectorAll(".mobile-menu a").forEach(link => {
  link.onclick = () => mobileMenu.classList.remove("active");
});

/* ================= STEP FIX (CRITICAL) ================= */
const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");
const progressBar = document.getElementById("progressBar");
const admissionForm = document.getElementById("admissionForm");

/* ================= ALERT ================= */
function showAlert(msg, type) {
  const box = document.getElementById("alertBox");
  box.className = "alert-" + type;
  box.innerHTML = msg;
  box.style.display = "block";
  setTimeout(() => (box.style.display = "none"), 3000);
}

/* ================= STEP NAVIGATION ================= */
function nextStep() {
  step1.classList.remove("active");
  step2.classList.add("active");
  progressBar.style.width = "100%";
}

function prevStep() {
  step2.classList.remove("active");
  step1.classList.add("active");
  progressBar.style.width = "50%";
}

/* ================= MARK CALCULATION ================= */
function calc() {
  let sum = 0;
  document
    .querySelectorAll("#subjects input[type=number]")
    .forEach(i => {
      if (i.value) sum += Number(i.value);
    });

  obtainedMarks.value = sum;
  percentage.value = sum ? ((sum / 625) * 100).toFixed(2) : "";
}

/* ================= FORM SUBMIT ================= */
admissionForm.addEventListener("submit", async e => {
  e.preventDefault();

  showAlert("Submitting application‚Ä¶", "info");

  const data = {
    name: name.value.trim(),
    fatherName: fatherName.value.trim(),
    motherName: motherName.value.trim(),
    dob: dob.value,
    mobile: mobile.value.trim(),
    familyMobile: familyMobile.value,
    email: email.value.trim(),
    satsId: satsId.value.trim(),
    sslcRegNo: sslcRegNo.value.trim(),

    kannada: +kannada.value,
    english: +english.value,
    hindi: +hindi.value,
    mathematics: +maths.value,
    science: +science.value,
    socialScience: +social.value,

    obtainedMarks: +obtainedMarks.value,
    totalMarks: +totalMarks.value,
    percentage: +percentage.value,
    combination: combination.value
  };

  try {
    const res = await fetch("/api/admission/apply", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (!res.ok) throw await res.text();
    const result = await res.json();

    showAlert("‚úÖ Application Submitted<br>ID: " + result.admissionId, "success");

    /* RESET FORM COMPLETELY */
    admissionForm.reset();
    step2.classList.remove("active");
    step1.classList.add("active");
    progressBar.style.width = "50%";

    setTimeout(() => {
      window.location.href = "check-status.html";
    }, 2000);
  } catch (err) {
    showAlert("‚ùå " + err, "error");
  }
});
</script>


</body>
</html>
